<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <title>ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
</head>
<body>
  <header>
    <h1>ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p>æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã‚¬ãƒãƒ£ã‚’å›ãã†ï¼</p>
  </header>
  <main class="gacya-center">
    <img src="machine.png" width="170" height="200" alt="åŠ›ã“ããƒ‘ãƒ¯ãƒ¼!!"> 
    <input type="number" id="userInput" placeholder="æ•°å€¤ã‚’å…¥åŠ›">

    <div class="button">
        <button id="gachaOnce" disabled>1å›ã‚¬ãƒãƒ£</button>
        <button id="gachaTen" disabled>10é€£ã‚¬ãƒãƒ£</button>
    </div>

    <p id="result">çµæœ: ???</p>
  </main>

  <script src="script.js"></script>
  <script>

    console.log("ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œä¸­");

    if (typeof Module !== "undefined") {
  Module.onRuntimeInitialized = () => {
    document.getElementById("gachaOnce").disabled = false;
    document.getElementById("gachaTen").disabled = false;
  };
}


document.getElementById("gachaOnce").addEventListener("click", () => {
  const val = parseInt(document.getElementById("userInput").value, 10);
  if (isNaN(val) || val < 1) {
    alert("1ä»¥ä¸Šã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    return;
  }

  const ret = Module.ccall("gacya", "number", ["number"], [val]);
  const resultText = (ret === 1) ? "å½“ãŸã‚ŠğŸ‰" : "ãƒã‚ºãƒ¬ğŸ’”";
  document.getElementById("result").textContent = `çµæœ: ${resultText}`;
});


document.getElementById("gachaTen").addEventListener("click", () => {
  const val = parseInt(document.getElementById("userInput").value, 10);
  if (isNaN(val) || val < 1) {
    alert("1ä»¥ä¸Šã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    return;
  }

  const ptr = Module.ccall("gacyas", "number", ["number"], [val]);
  const base = ptr >> 2; 

  const results = [];
  for (let i = 0; i < 10; i++) {
    results.push(Module.HEAP32[base + i]);
  }

  const hitCount = results.filter(r => r === 1).length;
  document.getElementById("result").textContent = `10é€£ã®çµæœ: ${hitCount}å›å½“ãŸã‚ŠğŸ¯ (${results.join(", ")})`;
});







  </script>
</body>
</html>










