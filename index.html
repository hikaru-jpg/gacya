<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <title>ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
</head>
<body>
  <header>
    <h1>ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p>æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã‚¬ãƒãƒ£ã‚’å›ãã†ï¼</p>
  </header>
  <main>
    <img src="machine.png" width="170" height="200" alt="åŠ›ã“ããƒ‘ãƒ¯ãƒ¼!!"> 
    <input type="number" id="userInput" placeholder="æ•°å€¤ã‚’å…¥åŠ›">
    <button id="gachaButton" disabled>ã‚¬ãƒãƒ£ã‚’å¼•ã</button>
    <p id="result">çµæœ: ???</p>
  </main>

  <!-- å¾“æ¥å‹: Emscriptenã§ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸscript.jsã‚’èª­ã¿è¾¼ã‚€ -->
  <script src="script.js"></script>
  <script>
    // ã‚¹ã‚¯ãƒªãƒ—ãƒˆè‡ªä½“ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª
    console.log("ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œä¸­");

    if (typeof Module !== "undefined") {
      Module.onRuntimeInitialized = () => {
        console.log("WASMãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†");
        document.getElementById("gachaButton").disabled = false;
      };
    } else {
      console.log("Module ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");
    }

    document.getElementById("gachaButton").addEventListener("click", () => {
      console.log("Button clicked"); // ã“ã“ã§ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‹ãƒ­ã‚°å‡ºåŠ›

      if (!Module) {
        alert("ã¾ã åˆæœŸåŒ–ä¸­ã®ã‚ˆã†ã§ã™ã€‚ã‚‚ã†å°‘ã—å¾…ã£ã¦ã‹ã‚‰è©¦ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const numberField = document.getElementById("userInput");
      const val = parseInt(numberField.value, 10);
      console.log("å…¥åŠ›å€¤:", numberField.value, "â†’ ãƒ‘ãƒ¼ã‚¹å¾Œ:", val);
      
      if (isNaN(val)) {
        alert("æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
        return;
      } else if (val < 1) {
        alert("1ä»¥ä¸Šã®å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
        return;
      }

      const ret = Module.ccall(
        "gacya",    // C++ é–¢æ•°å
        "number",   // è¿”ã‚Šå€¤ã®å‹
        ["number"], // å¼•æ•°ã®å‹
        [val]       // å®Ÿéš›ã®å¼•æ•°
      );
      console.log("gacya() ã®æˆ»ã‚Šå€¤:", ret);

      const ans = (ret === 1) ? "å½“ãŸã‚ŠğŸ‰" : "ãƒã‚ºãƒ¬ğŸ’”";
      document.getElementById("result").textContent = `çµæœ: ${ans}`;
    });
  </script>
</body>
</html>


